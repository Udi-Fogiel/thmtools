%%
%% This is file `thm-restate.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% thm-restate.dtx  (with options: `restate')
%% This is a generated file.
%% 
%% This file is part of the `thmtools' package.
%% The `thmtools' package has the LPPL maintenance status: maintained.
%% Current Maintainer is Ulrich M. Schwarz, ulmi@absatzen.de
%% 
%% Copyright (C) 2008-2020 by Ulrich M. Schwarz.
%% 
%% This file may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, version 1.3a.
%% This version is obtainable at
%% http://www.latex-project.org/lppl/lppl-1-3a.txt
%% 
%% 
\NeedsTeXFormat {LaTeX2e}
\ProvidesPackage {thm-restate}[2010/05/18 v24]

\let\@xa\expandafter
\let\@nx\noexpand
\@ifundefined{c@thmt@dummyctr}{%
  \newcounter{thmt@dummyctr}%
  }{}
\gdef\theHthmt@dummyctr{dummy.\arabic{thmt@dummyctr}}%
\gdef\thethmt@dummyctr{}%
\long\def\thmt@collect@body#1#2\end#3{%
  \@xa\thmt@toks\@xa{\the\thmt@toks #2}%
  \def\thmttmpa{#3}%\def\thmttmpb{restatable}%
  \ifx\thmttmpa\@currenvir%thmttmpb
    \@xa\@firstoftwo% this is the end of the environment.
  \else
    \@xa\@secondoftwo% go on collecting
  \fi{%
    \@xa#1\@xa{\the\thmt@toks}%
  }{%
    \@xa\thmt@toks\@xa{\the\thmt@toks\end{#3}}%
    \thmt@collect@body{#1}%
  }%
}

\def\thmt@trivialref#1#2{%
  \ifcsname r@#1\endcsname
    \@xa\@xa\@xa\thmt@trivi@lr@f\csname r@#1\endcsname\relax\@nil
  \else #2\fi
}
\def\thmt@trivi@lr@f#1#2\@nil{#1}

\def\thmt@innercounters{%
  equation}
\def\thmt@counterformatters{%
  @alph,@Alph,@arabic,@roman,@Roman,@fnsymbol}

\@for\displ:=\thmt@counterformatters\do{%
  \@xa\let\csname thmt@\displ\@xa\endcsname\csname \displ\endcsname
}%
\def\thmt@sanitizethe#1{%
  \@for\displ:=\thmt@counterformatters\do{%
    \@xa\protected@edef\csname\displ\endcsname##1{%
      \@nx\ifx\@xa\@nx\csname c@#1\endcsname ##1%
        \@xa\protect\csname \displ\endcsname{##1}%
      \@nx\else
        \@nx\csname thmt@\displ\endcsname{##1}%
      \@nx\fi
    }%
  }%
  \expandafter\protected@edef\csname the#1\endcsname{\csname the#1\endcsname}%
  \ifcsname theH#1\endcsname
    \expandafter\protected@edef\csname theH#1\endcsname{\csname theH#1\endcsname}%
  \fi
}

\newif\ifthmt@thisistheone
\newenvironment{thmt@restatable}[3][]{%
  \thmt@toks{}%
  \stepcounter{thmt@dummyctr}%
  \long\def\thmrst@store##1{%
    \@xa\gdef\csname #3\endcsname{%
      \@ifstar{%
        \thmt@thisistheonefalse\csname thmt@stored@#3\endcsname
      }{%
        \thmt@thisistheonetrue\csname thmt@stored@#3\endcsname
      }%
    }%
    \@xa\long\@xa\gdef\csname thmt@stored@#3\@xa\endcsname\@xa{%
      \begingroup
      \ifthmt@thisistheone
        \bgroup
        % ugly hack: save chapter,..subsection numbers
        % for equation numbers.
        \refstepcounter{thmt@dummyctr}%
        \def\@currentlabel{}%
        \@for\ctr:=\thmt@innercounters\do{%
          \thmt@sanitizethe{\ctr}%
          \protected@edef\@currentlabel{%
            \@currentlabel
            \protect\def\@xa\protect\csname the\ctr\endcsname{\csname the\ctr\endcsname}%
            \ifcsname theH\ctr\endcsname
              \protect\def\@xa\protect\csname theH\ctr\endcsname{%
                (restate \protect\theHthmt@dummyctr)\csname theH\ctr\endcsname}%
            \fi
            \protect\setcounter{\ctr}{\number\csname c@\ctr\endcsname}%
          }%
        }%
        \label{thmt@@#3@data}%
        \egroup
      \else
        \@xa\protected@edef\csname the#2\endcsname{%
          \thmt@trivialref{thmt@@#3}{??}}%
        \ifcsname r@thmt@@#3\endcsname\else
          \G@refundefinedtrue
        \fi
        \@xa\let\csname c@#2\endcsname=\c@thmt@dummyctr
        \@xa\let\csname theH#2\endcsname=\theHthmt@dummyctr
        \let\label=\@gobble
        \let\ltx@label=\@gobble% amsmath needs this
        \def\thmt@restorecounters{}%
        \@for\ctr:=\thmt@innercounters\do{%
          \protected@edef\thmt@restorecounters{%
            \thmt@restorecounters
            \protect\setcounter{equation}{\arabic{equation}}%
          }%
        }
        \thmt@trivialref{thmt@@#3@data}{}%
      \fi
      %\def\@currenvir{#2}%
      \csname #2\@xa\endcsname\ifx\@nx#1\@nx\else[#1]\fi
      \ifthmt@thisistheone
        \label{thmt@@#3}%
      \fi
      ##1
      \csname end#2\endcsname
      \ifthmt@thisistheone\else\thmt@restorecounters\fi
      \endgroup
    }%
    \csname #3\@xa\endcsname\ifthmt@thisistheone\else*\fi
    \@xa\end\@xa{\@currenvir}
  }%
  \thmt@collect@body\thmrst@store
}{%
  %% now empty, just used as a marker.
}

\newenvironment{restatable}{%
  \thmt@thisistheonetrue\thmt@restatable
}{%
  \endthmt@restatable
}
\newenvironment{restatable*}{%
  \thmt@thisistheonefalse\thmt@restatable
}{%
  \endthmt@restatable
}
\endinput
%%
%% End of file `thm-restate.sty'.
